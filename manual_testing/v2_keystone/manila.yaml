# vim: set ts=2 et:
# deployer bundle for development ('next') charms
# UOSCI relies on this for OS-on-OS deployment testing
openstack-services:
  series: trusty
  services:
    mysql:
      #charm: cs:~openstack-charmers/xenial/percona-cluster
      charm: local:xenial/percona-cluster
      constraints: mem=1G
      options:
        dataset-size: 50%
        root-password: mysql
    rabbitmq-server:
      #charm: cs:~openstack-charmers/xenial/rabbitmq-server
      charm: local:xenial/rabbitmq-server
      constraints: mem=1G
    keystone:
      #charm: cs:~openstack-charmers/xenial/keystone
      charm: local:xenial/keystone
      constraints: mem=1G
      options:
        admin-password: openstack
        admin-token: ubuntutesting
        preferred-api-version: "2"
    glance:
      charm: cs:~openstack-charmers/xenial/glance
      constraints: mem=1G
    nova-cloud-controller:
      charm: cs:~openstack-charmers/xenial/nova-cloud-controller
      constraints: mem=1G
      options:
        network-manager: Neutron
    nova-compute:
      charm: cs:~openstack-charmers/xenial/nova-compute
      constraints: mem=1G
    neutron-gateway:
      charm: cs:~openstack-charmers/xenial/neutron-gateway
      constraints: mem=1G
      options:
        bridge-mappings: physnet1:br-ex
        #data-port: br-ex:eth1
        instance-mtu: 1300
    neutron-api:
      charm: cs:~openstack-charmers/xenial/neutron-api
      constraints: mem=1G
      options:
        neutron-security-groups: True
        flat-network-providers: physnet1
    neutron-openvswitch:
      charm: cs:~openstack-charmers/xenial/neutron-openvswitch
    cinder:
      charm: cs:~openstack-charmers/xenial/cinder
      constraints: mem=1G
      options:
        block-device: "None"
        glance-api-version: 2
    manila:
      charm: local:xenial/manila
      options:
        debug: True
  relations:
    - [ keystone, mysql ]
    - [ manila, mysql ]
    - [ manila, rabbitmq-server ]
    - [ manila, keystone ]
    - [ glance, keystone]
    - [ glance, mysql ]
    - [ glance, "cinder:image-service" ]
    - [ nova-compute, "rabbitmq-server:amqp" ]
    - [ nova-compute, glance ]
    - [ nova-cloud-controller, rabbitmq-server ]
    - [ nova-cloud-controller, mysql ]
    - [ nova-cloud-controller, keystone ]
    - [ nova-cloud-controller, glance ]
    - [ nova-cloud-controller, nova-compute ]
    - [ cinder, keystone ]
    - [ cinder, mysql ]
    - [ cinder, rabbitmq-server ]
    - [ cinder, nova-cloud-controller ]
    - [ "neutron-gateway:amqp", "rabbitmq-server:amqp" ]
    - [ neutron-api, mysql ]
    - [ neutron-api, rabbitmq-server ]
    - [ neutron-api, nova-cloud-controller ]
    - [ neutron-api, neutron-openvswitch ]
    - [ neutron-api, keystone ]
    - [ neutron-api, neutron-gateway ]
    - [ neutron-openvswitch, nova-compute ]
    - [ neutron-openvswitch, rabbitmq-server ]
